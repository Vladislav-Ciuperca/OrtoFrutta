sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/m/MessageToast"],function(t,e,i,s,o){"use strict";return t.extend("gestionalerepartofruttacoop.controller.View1",{onInit(){this.AddModel=new sap.ui.model.json.JSONModel;this.getView().setModel(this.AddModel,"AddProducts");this.getView().getModel("AddProducts").setProperty("/Prodotti",[]);this.getRouter().getRoute("RouteView1").attachPatternMatched(this._gestioniProdottiMatched,this);this.oModel=this.getView().getModel("AddProducts");setTimeout(()=>{this.checkOfferte()},500)},onClearTable:function(){var t=this;jQuery.ajax({url:"/odata/v4/catalog-fruttarolo/clearFruttarolo()",method:"GET",contentType:"application/json",success:function(e){o.show("Tabella fruttarolo svuotata correttamente.");t._gestioniProdottiMatched()},error:function(t,e,i){s.error("Errore durante la cancellazione della tabella:\n"+t.responseText)}})},functionPostFlusso:function(){let t=this.getView().getModel("AddProducts").getProperty("/Prodotti");let e={arrayProducts:t};console.log(JSON.stringify(e));jQuery.ajax({url:"/odata/v4/catalog-fruttarolo/functionGetFlusso",method:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(e),success:function(t){},error:function(t,e,i){console.error("Errore nella chiamata:",i);console.log("Dettagli errore:",t.responseText)}})},onEdit:function(){var t=this.getOwnerComponent().getModel().sServiceUrl;console.log(t,"functionGetFlusso");var e=this.getView().getModel("AddProducts");this.savedData=JSON.stringify(e.getProperty("/Prodotti"));console.log(e.getProperty("/Prodotti"));this.byId("modifica").setVisible(false);this.byId("undo").setVisible(true);this.byId("barra").setVisible(true);this.byId("input_categoria").setVisible(true);this.byId("text_categoria").setVisible(false);this.byId("input_nome").setVisible(true);this.byId("text_nome").setVisible(false);this.byId("input_quanita").setVisible(true);this.byId("text_quantita").setVisible(false);this.byId("input_prezzo").setVisible(true);this.byId("text_prezzo").setVisible(false);this.byId("input_sconto").setVisible(true);this.byId("text_sconto").setVisible(false);this.byId("input_data").setVisible(true);this.byId("text_data").setVisible(false);this.byId("input_origine").setVisible(true);this.byId("text_origine").setVisible(false);this.byId("delete").setVisible(true)},onSave:function(){let t=this.getView().getModel("AddProducts").getProperty("/Prodotti");let e;for(const i of t){if(i.prodotto&&i.quantita_giacenza){e=true}else{e=false;s.error("Nome e QuantiÃ  sono dei campi obbligatori");return"break"}}if(e){this.byId("modifica").setVisible(true);this.byId("undo").setVisible(false);this.byId("barra").setVisible(false);setTimeout(()=>{this.byId("input_categoria").setVisible(false);this.byId("text_categoria").setVisible(true);this.byId("input_nome").setVisible(false);this.byId("text_nome").setVisible(true);this.byId("input_quanita").setVisible(false);this.byId("text_quantita").setVisible(true);this.byId("input_prezzo").setVisible(false);this.byId("text_prezzo").setVisible(true);this.byId("input_sconto").setVisible(false);this.byId("text_sconto").setVisible(true);this.byId("input_data").setVisible(false);this.byId("text_data").setVisible(true);this.byId("input_origine").setVisible(false);this.byId("text_origine").setVisible(true)},500);this.byId("delete").setVisible(false);this.functionPostFlusso();this.checkOfferte()}},checkOfferte:function(){let t=this.oModel.getProperty("/Prodotti").map(t=>t.sconto);let e=this.byId("statoOfferte");let i=this.getView().getModel("i18n").getResourceBundle();let s=i.getText("text_nessuna");let o=0;t.forEach(t=>{if(t){o++}if(o>0){e.setState("Success");e.setText(o)}else if(o==0){e.setState("Error");e.setText(s)}})},onUndo:function(){var t=this;var e=this.getView().getModel("AddProducts");var i=JSON.stringify(e.getProperty("/Prodotti"));var o=this.savedData;var r=i==o;if(r){this.undoShit()}else{s.confirm("Vuoi annulare le modifiche?",{icon:s.Icon.WARNING,title:"Annulla",actions:[s.Action.OK,s.Action.CANCEL],emphasizedAction:s.Action.OK,initialFocus:s.Action.CANCEL,dependentOn:this.getView(),onClose:function(e){if(e===s.Action.OK){t.undoShit()}else if(s.Action.CANCEL){}}})}},onlyNumbers:function(t){let e=t.getSource();let i=e.getValue();if(/^[0-9.,]*$/.test(i)){}else{let t=i.split("");t.splice(t.length-1,1);let s=t.join("");e.setValue(s);sap.m.MessageToast.show("Questo campo accetta solo numeri",{duration:1e3,width:"20em"})}},undoShit:function(){this.byId("modifica").setVisible(true);this.byId("undo").setVisible(false);this.byId("barra").setVisible(false);this._gestioniProdottiMatched();this.byId("input_categoria").setVisible(false);this.byId("text_categoria").setVisible(true);this.byId("input_nome").setVisible(false);this.byId("text_nome").setVisible(true);this.byId("input_quanita").setVisible(false);this.byId("text_quantita").setVisible(true);this.byId("input_prezzo").setVisible(false);this.byId("text_prezzo").setVisible(true);this.byId("input_sconto").setVisible(false);this.byId("text_sconto").setVisible(true);this.byId("input_data").setVisible(false);this.byId("text_data").setVisible(true);this.byId("input_origine").setVisible(false);this.byId("text_origine").setVisible(true);this.byId("delete").setVisible(false)},onDelete:function(t){let e=this;var i=t.getSource().getParent().sId.split("row")[t.getSource().getParent().sId.split("row").length-1];let o=this.getView().getModel("AddProducts").getProperty("/Prodotti")[i].prodotto;s.confirm("Stai cancellando l' elemento "+o,{icon:s.Icon.WARNING,title:"Elimina",actions:[s.Action.OK,s.Action.CANCEL],emphasizedAction:s.Action.OK,dependentOn:this.getView(),onClose:function(i){if(i===s.Action.OK){var o=t.getSource().getParent().sId.split("row")[t.getSource().getParent().sId.split("row").length-1];console.log("sto cancellando",e.getView().getModel("AddProducts").getProperty("/Prodotti")[o]);e.getView().getModel("AddProducts").getProperty("/Prodotti").splice(o,1);var r=e.getView().getModel("AddProducts").getProperty("/Prodotti");e.getView().getModel("AddProducts").setProperty("/Prodotti",r)}else if(i===s.Action.CANCEL){}}})},add:function(){this.byId("barra").setVisible(true);const t={categoria:"",data_aggiornamento:(new Date).toLocaleDateString({day:"2-digit",month:"2-digit",year:"2-digit"}),origine:"",prodotto:"",prezzo_unitario:"",quantita_giacenza:"",sconto:""};let e=this.oModel.getProperty("/Prodotti");e.push(t);this.oModel.setProperty("/Prodotti",e);this.oModel.refresh(true);this.byId("modifica").firePress()},getRouter:function(){return sap.ui.core.UIComponent.getRouterFor(this)},_gestioniProdottiMatched:function(){var t=this.getOwnerComponent().getModel().sServiceUrl;var e=this;e.makeAjaxRequest(t+"fruttarolo",function(t){e.getView().getModel("AddProducts").setProperty("/Prodotti",t.value)}.bind(e),function(t){}.bind(e))},makeAjaxRequest:function(t,e,i){let s=this;jQuery.ajax({url:t,dataType:"json",success:function(t){if(typeof e==="function"){e(t)}},error:function(t){if(typeof i==="function"){i(t)}}})},getArray:function(){console.log(this.getView().getModel("AddProducts").getProperty("/Prodotti"))},onNumberOnly:function(t){var e=t.getParameter("value");console.log("scrivendo");if(!/^\d*$/.test(e)){t.getSource().setValue(e.replace(/\D/g,""))}}})});
//# sourceMappingURL=View1.controller.js.map